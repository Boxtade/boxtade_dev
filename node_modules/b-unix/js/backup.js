var cmdSys=require("./cmd_sys"),time=require("./time"),fs=require("fs"),oldBackups,newBackups,i=0,t,setup,number_config,backup=function(){for(var s=0;number_config-1>=s;s++){var e=time.date();newBackups[s][i]=setup.filename(s)+"_"+e+setup.extension(s);var p="cp "+setup.path_src(s)+setup.filename(s)+setup.extension(s)+" "+setup.path_copy(s)+newBackups[s][i];cmdSys.process(p,null),""!=oldBackups[s][i]?(p="rm -f "+setup.path_copy(s)+oldBackups[s][i],cmdSys.process(p,null),p="sshpass -p "+setup.pwd_dest(s)+" scp -r "+setup.path_copy(s)+newBackups[s][i]+" "+setup.user_dest(s)+"@"+setup.host(s)+":"+setup.path_dest(s),cmdSys.process(p,null),p="sshpass -p "+setup.pwd_dest(s)+" ssh "+setup.user_dest(s)+"@"+setup.host(s)+" rm -f "+setup.path_dest(s)+oldBackups[s][i],cmdSys.process(p,null),fs.appendFile("bunix.log","Backup done : "+newBackups[s][i]+"\n")):(p="sshpass -p "+setup.pwd_dest(s)+" scp -r "+setup.path_copy(s)+newBackups[s][i]+" "+setup.user_dest(s)+"@"+setup.host(s)+":"+setup.path_dest(s),cmdSys.process(p,null),fs.appendFile("bunix.log","Backup done : "+newBackups[s][i]+"\n")),oldBackups[s][i]=newBackups[s][i]}i>=setup.number_backups()-1?i=0:i++};exports.start=function(s,e){setup=s,cmdSys.init(e),t=time.timer(setup.hour(),setup.minute(),setup.second()),number_config=setup.len(),oldBackups=new Array,newBackups=new Array;for(var p=0;number_config>=p;p++){oldBackups[p]=new Array(setup.number_backups());for(var u=0;u<setup.number_backups();u++)oldBackups[p][u]=""}for(var a=0;number_config>=a;a++){newBackups[a]=new Array(setup.number_backups());for(var c=0;c<setup.number_backups();c++)newBackups[a][c]=""}backup(),setInterval(backup,t)};